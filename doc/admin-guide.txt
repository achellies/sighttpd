
Sighttpd Administrator's Guide
==============================

The configuration file is looked for in /etc/sighttpd/sighttpd.conf


1. Syntax
---------

Comments are marked with a '#' character, and continue to the end of line.

Configuration directives are single keywords followed by whitespace and a
value (to the end of the line, or comment character).

Configuration is grouped in blocks; the names of directives are scoped within
a configuration block. Any configuration directives outside of a block are
global to the entire configuration.

For example, the configuration file:

-----
Listen 3000

<StaticText>
	Path "/welcome.txt"
	Text "Hello, world!"
</StaticText>
-----

specifies one global directive ("Listen 3000"), and one block ("StaticText").
Within that block, the directives "Path" and "Text" appear.


2. Stdin: Configuring streaming from standard input
---------------------------------------------------

This section explains how to configure streaming of data from stdin with
three examples:

	1. plain text
	2. H.264 video
	3. Motion JPEG

2.1. Streaming text updates

This configuration prints a timestamp every second. The content appears at
the path /date.txt (eg. http://localhost/date.txt):

sighttpd.conf:

-----
Listen 3000

<Stdin>
	Path "/date.txt"
	Type "text/plain"
</Stdin>
-----

Then, run:

    $ while `true`; do date; sleep 1; done | sighttpd

Then connect from another terminal:

$ curl -i http://localhost:3000/date.txt
HTTP/1.1 200 OK
Date: Wed, 07 Apr 2010 04:23:09 GMT
Server: Sighttpd/0.9.0
Content-Type: text/plain

Wed Apr  7 13:23:09 JST 2010
Wed Apr  7 13:23:10 JST 2010
Wed Apr  7 13:23:11 JST 2010
...



2.2. Streaming H.264 video

(This replicates the default configration for handling /stream.264 of
sighttpd-0.9.0).

sighttpd.conf:

-----
Listen 3000

<Stdin>
	Path "/stream.264"
	Type "video/mp4"
</Stdin>
-----

Then run your streaming video input, eg:

	$ shcodecs-record k264-v4l2-stream.ctl | sighttpd

and connect with a video player:

	$ mplayer http://localhost:3000/stream.264 -fps 30

2.3. Motion MJPEG

(This replicates the default configration for handling /mjpeg of
sighttpd-0.9.0).

sighttpd.conf:

-----
Listen 3000

<Stdin>
	Path "/stream.264"
	Type "multipart/x-mixed-replace; boundary=++++++++"
</Stdin>
-----

This configuration expects that a series of jpeg comes in from stdin. At
each boundary the following headers must be inserted:

   --++++++++
   Content-Type: image/jpeg
   Content-length: <size of jpeg file>

examples/mjpeg_test.sh is provided for testing purpose. Execute the following:

    $ examples/mjpeg_test.sh file1 file2 file3 ...

Then open 'http://localhost:3000/mjpeg/' with Firefox.


3. Streaming video with SHRecord
--------------------------------

sighttpd includes direct support for capture and encoding on SH-Mobile, using
libshcodecs, libshveu and libuiomux. The configuration:

-----
Listen 3000

<SHRecord>
        Path "/video0/vga.264"
        CtlFile "/usr/share/shcodecs-record/k264-v4l2-vga-stream.ctl"
</SHRecord>

<SHRecord>
        Path "/video0/cif.264"
        CtlFile "/usr/share/shcodecs-record/k264-v4l2-cif-stream.ctl"
</SHRecord>
-----

will make two H.264 streams appear at:

http://ecovec:3000/video0/vga.264
http://ecovec:3000/video0/cif.264

The same control files that are used for shcodecs-record can be used - the
output filename is simply ignored.
